<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kiss Collector ðŸ’‹</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #ffe6f0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
    }
    canvas {
      background: #ffccdd;
      display: block;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 22px;
      font-weight: bold;
      color: #d63384;
    }
  </style>
</head>
<body>
  <div id="score">Score: 0 / 20</div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Face images
    const herFace = new Image();
    herFace.src = "her.png"; // replace with girlfriendâ€™s face
    const myFace = new Image();
    myFace.src = "me.png"; // replace with your face

    let score = 0;
    let gameOver = false;

    // Player
    const player = {
      x: canvas.width / 2 - 50,
      y: canvas.height - 120,
      width: 100,
      height: 100,
      speed: 8
    };

    // Falling kisses
    const kisses = [];

    function spawnKiss() {
      kisses.push({
        x: Math.random() * (canvas.width - 50),
        y: -50,
        width: 60,
        height: 60,
        speed: 2 + Math.random() * 2
      });
    }

    setInterval(spawnKiss, 2000); // new kiss every 2 seconds

    // Sparkles + hearts effect
    const effects = [];
    function createEffect(x, y) {
      for (let i = 0; i < 8; i++) {
        effects.push({
          x, y,
          dx: (Math.random() - 0.5) * 4,
          dy: (Math.random() - 0.5) * 4,
          alpha: 1,
          size: 10 + Math.random() * 8,
          shape: Math.random() > 0.5 ? "heart" : "sparkle"
        });
      }
    }

    function drawEffects() {
      for (let i = effects.length - 1; i >= 0; i--) {
        const e = effects[i];
        ctx.globalAlpha = e.alpha;

        if (e.shape === "heart") {
          ctx.fillStyle = "red";
          ctx.beginPath();
          ctx.moveTo(e.x, e.y);
          ctx.bezierCurveTo(e.x - e.size/2, e.y - e.size/2, e.x - e.size, e.y + e.size/3, e.x, e.y + e.size);
          ctx.bezierCurveTo(e.x + e.size, e.y + e.size/3, e.x + e.size/2, e.y - e.size/2, e.x, e.y);
          ctx.fill();
        } else {
          ctx.fillStyle = "yellow";
          ctx.beginPath();
          ctx.arc(e.x, e.y, e.size/4, 0, Math.PI*2);
          ctx.fill();
        }

        ctx.globalAlpha = 1;
        e.x += e.dx;
        e.y += e.dy;
        e.alpha -= 0.02;
        if (e.alpha <= 0) effects.splice(i, 1);
      }
    }

    // ðŸŽµ Web Audio for kiss sounds
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const kissFiles = ["kiss1.mp3", "kiss2.mp3", "kiss3.mp3"];
    let kissBuffers = [];

    async function loadSounds() {
      for (let file of kissFiles) {
        const resp = await fetch(file);
        const arrayBuffer = await resp.arrayBuffer();
        const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
        kissBuffers.push(audioBuffer);
      }
    }

    function playKiss() {
      if (kissBuffers.length === 0) return;
      const source = audioCtx.createBufferSource();
      const buf = kissBuffers[Math.floor(Math.random() * kissBuffers.length)];
      source.buffer = buf;
      source.connect(audioCtx.destination);
      source.start();
    }

    // resume AudioContext after first tap/click (mobile fix)
    document.body.addEventListener("touchstart", () => {
      if (audioCtx.state === "suspended") audioCtx.resume();
    }, { once: true });
    document.body.addEventListener("mousedown", () => {
      if (audioCtx.state === "suspended") audioCtx.resume();
    }, { once: true });

    loadSounds();

    // Controls
    let keys = {};
    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    let touchX = null;
    canvas.addEventListener("touchstart", e => {
      touchX = e.touches[0].clientX;
    });
    canvas.addEventListener("touchmove", e => {
      touchX = e.touches[0].clientX;
    });
    canvas.addEventListener("touchend", () => {
      touchX = null;
    });

    function movePlayer() {
      if (keys["ArrowLeft"]) player.x -= player.speed;
      if (keys["ArrowRight"]) player.x += player.speed;
      if (touchX !== null) player.x = touchX - player.width/2;

      if (player.x < 0) player.x = 0;
      if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
    }

    function updateGame() {
      if (gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // draw player
      ctx.drawImage(herFace, player.x, player.y, player.width, player.height);

      // draw kisses
      for (let i = kisses.length - 1; i >= 0; i--) {
        const k = kisses[i];
        ctx.drawImage(myFace, k.x, k.y, k.width, k.height);
        k.y += k.speed;

        // collision
        if (
          k.x < player.x + player.width &&
          k.x + k.width > player.x &&
          k.y < player.y + player.height &&
          k.y + k.height > player.y
        ) {
          score++;
          document.getElementById("score").innerText = `Score: ${score} / 20`;
          playKiss();
          createEffect(k.x + k.width/2, k.y + k.height/2);
          kisses.splice(i, 1);

          if (score >= 20) {
            gameOver = true;
            setTimeout(() => alert("You won! ðŸ’– She collected all kisses!"), 100);
          }
        }

        // remove if out of screen (no losing condition here!)
        if (k.y > canvas.height) {
          kisses.splice(i, 1);
        }
      }

      drawEffects();
      movePlayer();

      requestAnimationFrame(updateGame);
    }

    updateGame();
  </script>
</body>
</html>
