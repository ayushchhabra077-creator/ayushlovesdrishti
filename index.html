<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kiss Collector Game</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: pink;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    canvas {
      border: 2px solid white;
      background: linear-gradient(to bottom, #ffe6f0, #ffb3d9);
      display: block;
    }
    #scoreboard {
      font-size: 24px;
      font-weight: bold;
      color: white;
      margin: 10px;
    }
    #game-over {
      display: none;
      font-size: 28px;
      font-weight: bold;
      color: red;
      margin-top: 20px;
    }
    #start-btn {
      margin-bottom: 10px;
      padding: 10px 20px;
      font-size: 18px;
      background: #ff4d79;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="start-btn">Start the game of catching love my dear? ðŸ’–</button>
  <div id="scoreboard">Score: 0</div>
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <div id="game-over">
    <p id="end-text"></p>
    <p id="final-score"></p>
  </div>

  <!-- Background music -->
  <audio id="bg-music" src="assets/bg.mp3" loop></audio>

  <!-- Kiss sounds -->
  <audio id="kiss1" src="assets/kiss1.mp3"></audio>
  <audio id="kiss2" src="assets/kiss2.mp3"></audio>
  <audio id="kiss3" src="assets/kiss3.mp3"></audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let playerImg = new Image();
    playerImg.src = "assets/her.png"; // her face
    let heartImg = new Image();
    heartImg.src = "assets/him.png"; // your face falling

    let player = {
      x: canvas.width/2 - 40,
      y: canvas.height - 100,
      width: 80,
      height: 80,
      speed: 5
    };

    let hearts = [];
    let score = 0;
    let gameOver = false;
    let gameStarted = false;

    // Touch controls
    let touchX = null;

    document.addEventListener("keydown", (e) => {
      if(e.key === "ArrowLeft") player.x -= player.speed * 2;
      if(e.key === "ArrowRight") player.x += player.speed * 2;
    });

    canvas.addEventListener("touchstart", (e) => {
      touchX = e.touches[0].clientX;
    });

    canvas.addEventListener("touchmove", (e) => {
      let deltaX = e.touches[0].clientX - touchX;
      player.x += deltaX * 0.3;
      touchX = e.touches[0].clientX;
    });

    function spawnHeart(){
      let size = 50;
      let x = Math.random() * (canvas.width - size);
      let y = -size;
      let speed = 1 + Math.random()*1.5;
      hearts.push({x,y,size,speed});
    }

    function drawPlayer(){
      ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
    }

    function drawHearts(){
      hearts.forEach(h=>{
        ctx.drawImage(heartImg, h.x, h.y, h.size, h.size);
      });
    }

    function updateHearts(){
      for(let i=0;i<hearts.length;i++){
        hearts[i].y += hearts[i].speed;

        // collision detection
        if(
          hearts[i].x < player.x + player.width &&
          hearts[i].x + hearts[i].size > player.x &&
          hearts[i].y < player.y + player.height &&
          hearts[i].y + hearts[i].size > player.y
        ){
          score++;
          document.getElementById("scoreboard").textContent = "Score: " + score;

          // FIXED kiss sound for mobile (clone node each time)
          const sounds = ["kiss1","kiss2","kiss3"];
          const soundId = sounds[Math.floor(Math.random()*sounds.length)];
          const original = document.getElementById(soundId);
          const kissSound = original.cloneNode(true);
          kissSound.play().catch(()=>{});

          spawnSparkles(hearts[i].x + hearts[i].size/2, hearts[i].y + hearts[i].size/2);

          hearts.splice(i,1);

          if(score >= 20){
            gameOver = true;
            document.getElementById("final-score").textContent = "Final Score: " + score;
            document.getElementById("end-text").textContent = "You did it! ðŸ’–";
            document.getElementById("game-over").style.display = "block";
          }
        }
      }
    }

    // Sparkles + hearts effect
    let particles = [];
    function spawnSparkles(x,y){
      for(let i=0;i<10;i++){
        particles.push({
          x,y,
          dx:(Math.random()-0.5)*2,
          dy:(Math.random()-0.5)*2,
          life:50,
          type: Math.random() > 0.5 ? "heart" : "sparkle"
        });
      }
    }

    function drawParticles(){
      for(let i=0;i<particles.length;i++){
        let p = particles[i];
        ctx.globalAlpha = p.life/50;
        if(p.type === "heart"){
          ctx.fillStyle = "red";
          ctx.beginPath();
          ctx.moveTo(p.x, p.y);
          ctx.arc(p.x-3, p.y-3, 3, 0, Math.PI*2);
          ctx.arc(p.x+3, p.y-3, 3, 0, Math.PI*2);
          ctx.lineTo(p.x, p.y+4);
          ctx.fill();
        } else {
          ctx.fillStyle = "yellow";
          ctx.beginPath();
          ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
        p.x += p.dx;
        p.y += p.dy;
        p.life--;
        if(p.life<=0){
          particles.splice(i,1);
          i--;
        }
      }
    }

    function gameLoop(){
      if(gameOver) return;

      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawPlayer();
      drawHearts();
      updateHearts();
      drawParticles();

      requestAnimationFrame(gameLoop);
    }

    // Start button
    document.getElementById("start-btn").addEventListener("click", ()=>{
      if(!gameStarted){
        gameStarted = true;
        gameOver = false;
        score = 0;
        document.getElementById("scoreboard").textContent = "Score: 0";
        document.getElementById("game-over").style.display = "none";
        hearts = [];
        particles = [];

        // play bg music at 50% volume
        const bgMusic = document.getElementById("bg-music");
        bgMusic.volume = 0.5;
        bgMusic.play().catch(()=>{});

        setInterval(spawnHeart, 2000);
        gameLoop();
      }
    });
  </script>
</body>
</html>
